2018年 01月 04日 星期四 15:42:30 CST
----------------------------------------------------------------------
# 1. 三 进程
## 什么是进程
程序是一个包含可执行指令的文件，而进程是一个开始执行但还没有结束的程序的实例。进程的标准定义是：“进程是一个具有独立功能的程序关于某个数据集合的一次可以并发执行的运行活动，是处于活动状态的计算机程序”。  
在进程的整个运行期间，它将会用到各种系统资源，会用到CPU运行它的指令，需要物理内存保存它的数据，它可能打开和使用各种文件，直接或间接地使用系统中的各种物理设备。系统中最为宝贵的资源是CPU，Linux是一个多进程的操作系统，Linux内核为每个进程指派一定的运行时间，这个时间通常很短，短到毫秒为单位，然后依照某种规则，从多个进程中挑选一个运行，其他的进程暂时等待，当正在运行的那个进程时间耗尽，或执行完毕退出。当正在运行的进程等待其他的系统资源时，Linux 内核将取得CPU的控制权，并将CPU分配给其他正在等待的进程。因为每个进程占用的时间很短，从使用者的角度来看，就好像多个进程同时运行一样了。Linux系统内核必须了解进程本身的情况和进程所用到的各种资源，以便在多个进程之间合理地分配系统资源.  
Linux是一个多处理操作系统，进程具有独立的权限与职责。如果系统中某个进程崩溃，它不会影响到其余的进程。每个进程运行在其各自的虚拟地址空间中，进程之间可以通过由内核控制的机制互相通讯.  Linux是一个多处理操作系统，进程具有独立的权限与职责。如果系统中某个进程崩溃，它不会影响到其余的进程。每个进程运行在其各自的虚拟地址空间中，进程之间可以通过由内核控制的机制互相通讯.  

## tast struct简介 
为了让linux来管理系统中的进程，每个进程用一个task_struct数据结构来表示。队列task包含指向系统中所有task_struct结构的指针。创建新进程时，Linux将从系统内存中分配一个task_struct结构并将其加入task队列中。系统中还有一个当前进程的指针，用来指向当前运行进程的结构。  
task_struct数据结构庞大而复杂，但它可以分成一些功能组成部分：  
1. 进程状态
进程在执行过程中会根据环境来改变状态，Linux进程有以下状态: 运行状态、等待状态、停止状态和僵尸状
态。
2. 进程调度信息
调度器需要这些信息以便判定系统中哪个进程最迫切需要运行。
3. 标识符
系统中每个进程都有进程标志。进程标志并不是task队列的索引，它仅仅是个数字。每个进程还有一个用户与组标志，它们用来控制进程对系统中文件和设备的存取权限。
4. 进程间通信
Linux支持经典的Unix IPC机制。
5. 进程关系
Linux系统中所有进程都是相互联系的。除了初始化进程外，所有进程都有一个父进程。新进程不是被创建，而是被复制，或者从以前的进程克隆而来。每个进程对应的task_struct结构中包含有指向其父进程和兄弟进程(具有相同父进程的进程)以及子进程的指针。
6. 时间和定时器
核心需要记录进程的创建时间以及在其生命期间消耗的CPU时间。
7. 文件系统
进程可以自由地打开或者关闭文件，进程的task_struct结构中包含一个指向每个打开文件描述符的指针。两个指向VFS索引节点的指针。每个VFS索引节点唯一地表示文件中的一个目录或者文件，同时还对底层文件系统提供了统一的接口。第一个索引节点是进程的根目录，第二个节点是当前的工作目录。两个VFS索引节点都有一个计数字段用来表明指向节点的进程数，当多个进程引用它们时，它的值就增加。
8. 虚拟内存
多数进程都有一些虚拟内存，linux核心必须跟踪虚拟内存与系统物理内存的映射关系。
9. 处理器的内容
进程可以认为是系统当前状态的总和。进程运行时，它将使用处理器的寄存器被重新设定。在它的task_struct结构中。当调度器重新调度该进程时，所有上下文
10. 绑定的终端
进程是否需要控制终端，也记录在task_struct

## 进程状态以及状态切换  
进程在生存周期中的其状态时变化的。 下面是Linux操作系统的几种常见状态：  
- R运行状态，此状态下进程正在运行或者是准备运行状态(即就绪状态)。在ps命令列出的状态列Stat列中，字母R表示运行状态。
- S等待状态，进程正在等待事件的发生或者等待某种系统资源。Linux操作系统中的等待进程分为可中断等待和不可中断等待。可中断等待进程可以被信号(signal)中断, ps命令看到的字母S表示程序处于可中断等待状态。
- D不可中断状态进程不受信号干扰，直到硬件状态改变，通常是处于I/O操作过程中，字母D表示进程处于不可中断等待状态。
- T停止状态，进程被停止，通常是收到了一个控制信号或者正在被跟踪调试。字母T表示进程处于停止状态，只有被唤醒才能分配到cpu时间片。
- Z僵尸状态，进程由于某种原因已经终止或结束，但在进程表项中仍有记录，该记录可由父进程收集。字母Z表示进程处于僵尸状态  

在linux系统中，进程的执行模式划分为用户模式和内核模式。如果当前运行的是应用程序或者内核之外的系统程序，那么对应进程就在用户模式下运行：如果在用户程序执行过程中出现系统调用或者发生中断事件，就要运行操作系统核心程序，进程模式就变成了内核模式。  
按照进程的功能和运行的程序分类，进程可以划分为两大类：一类是系统进程，只运行在内核模式，执行操作系统代码，完成一些管理性的工作，例如内存分配和进程切换，另外一个类是用户进程，通常在用户模式中执行,并通过系统调用或在出现中断、异常时进入内核模式。用户进程既可以在用户模式下运行，也可以在内核模式下运行。  
## 进程环境变量 
每个进程都有它所运行的的一个环境变量，环境变量一般是存放在内存的用户空间的一个环境变量表中，这个环境变量表是在进程生成时，从父进程的环境变量表中拷贝一份。
！[进程环境变量](https://gitee.com/zmf96/mynote/raw/master/img/%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20180104161224.png)

